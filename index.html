<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­í˜• ì‚¬íšŒì„± ê²€ì‚¬(KSIP)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* [ë””ìì¸ í…Œë§ˆ: í”„ë¦¬ë¯¸ì—„ & í”„ë¡œí˜ì…”ë„] */
        :root {
            --primary: #1a252f;       /* ë”¥ ë„¤ì´ë¹„ (ì‹ ë¢°) */
            --accent: #c0a375;        /* ì•¤í‹± ê³¨ë“œ (ê³ ê¸‰) */
            --bg: #fdfdfd;            /* ë¯¸ìƒ‰ ë°°ê²½ (ëˆˆ í¸ì•ˆí•¨) */
            --text: #2c3e50;          /* ì§™ì€ íšŒìƒ‰ (ê°€ë…ì„±) */
            --surface: #ffffff;       /* ì¹´ë“œ ë°°ê²½ */
            --border: #e0e0e0;        /* ê²½ê³„ì„  */
        }

        body {
            font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            background-color: #f4f6f9; /* ì „ì²´ ë°°ê²½ ì‚´ì§ íšŒìƒ‰ */
            margin: 0;
            padding: 20px 10px; /* ëª¨ë°”ì¼ ì¢Œìš° ì—¬ë°± í™•ë³´ */
            color: var(--text);
            display: flex;
            justify-content: center;
            line-height: 1.6;
            word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ (ìì—°ìŠ¤ëŸ¬ì›€) */
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: var(--surface);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
            border: 1px solid rgba(0,0,0,0.02);
        }

        /* ì œëª© (ì¹˜íŠ¸í‚¤) */
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
            font-weight: 800;
            user-select: none;
            letter-spacing: -0.5px;
        }

        h3 {
            border-left: 4px solid var(--accent); /* ê³¨ë“œ í¬ì¸íŠ¸ */
            padding-left: 12px;
            margin-top: 40px;
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.3rem;
            font-weight: 700;
            page-break-after: avoid;
        }

        /* ë¡œë”© í™”ë©´ */
        #loading-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid #eee;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ì§ˆë¬¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ê°œì„  */
        .question-box {
            background: #fff;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        .question-box:last-child { border-bottom: none; }
        
        .question-text {
            font-size: 1.05rem;
            font-weight: 600;
            display: block;
            margin-bottom: 12px;
            color: #333;
        }

        /* ì„ íƒì§€ ë²„íŠ¼ (ëª¨ë°”ì¼ ìµœì í™”) */
        .options {
            display: flex;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .option-label {
            flex: 1;
            cursor: pointer;
            position: relative;
        }
        .option-label input { display: none; }
        
        .btn-text {
            width: 100%;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fcfcfc;
            font-size: 0.9rem;
            color: #777;
            border-right: 1px solid #eee;
            transition: all 0.2s ease;
            text-align: center;
            padding: 0 2px;
        }
        .option-label:last-child .btn-text { border-right: none; }
        
        /* ì„ íƒëœ ìƒíƒœ - ê³¨ë“œ í…Œë§ˆ ì ìš© */
        .option-label input:checked + .btn-text {
            background: var(--primary);
            color: var(--accent); /* ê¸€ìëŠ” ê³¨ë“œ */
            font-weight: 700;
        }

        /* ê²°ê³¼ í™”ë©´ */
        #result-area { display: none; }

        /* ê²°ê³¼ ìš”ì•½ ë°•ìŠ¤ (í”„ë¦¬ë¯¸ì—„ ì¹´ë“œ ìŠ¤íƒ€ì¼) */
        .one-liner-box {
            background: linear-gradient(135deg, #2c3e50, #1a252f);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(44, 62, 80, 0.25);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .one-liner-sub {
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }
        .one-liner-main {
            font-size: 1.6rem;
            font-weight: 700;
            line-height: 1.4;
        }

        /* ìˆœìœ„ ë°•ìŠ¤ */
        .rank-container {
            display: flex;
            gap: 20px;
            margin: 25px 0;
        }
        .rank-box {
            flex: 1;
            padding: 20px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .rank-title {
            font-weight: 700;
            margin-bottom: 12px;
            display: block;
            font-size: 1rem;
            color: var(--primary);
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }
        .rank-list span {
            display: block;
            margin-bottom: 6px;
            font-size: 0.95rem;
            color: #555;
        }

        /* AI ê²°ê³¼ ë°•ìŠ¤ */
        .ai-btn-area {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
        }
        
        /* AI ë¶„ì„ ë‚´ìš© ë°•ìŠ¤ (ê°€ë…ì„± ê°•í™”) */
        .ai-box {
            background: #fff;
            border-left: 3px solid var(--accent); /* ì™¼ìª½ì— ê³¨ë“œ ë¼ì¸ */
            padding: 20px 25px;
            margin-bottom: 0;
            line-height: 1.8;
            font-size: 1rem;
            text-align: justify;
            color: #444;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border-radius: 0 8px 8px 0;
        }
        .ai-box strong { color: var(--primary); font-weight: 700; background: rgba(192, 163, 117, 0.1); padding: 0 2px; }
        
        .ai-section-group {
            page-break-inside: avoid;
            margin-bottom: 35px;
            display: block;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .action-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            color: white;
            margin-top: 12px;
            transition: transform 0.1s, box-shadow 0.2s;
            letter-spacing: 0.5px;
        }
        .action-btn:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .action-btn:active { transform: scale(0.98); }
        
        #submit-btn { background-color: var(--primary); }
        #ai-btn { background: linear-gradient(135deg, #3498db, #2980b9); }
        #pdf-btn { background-color: #27ae60; }
        #retry-btn { background-color: #95a5a6; }

        .chart-container { position: relative; height: 320px; margin-top: 30px; page-break-inside: avoid; }

        /* í…Œì´ë¸” */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 15px;
            border-top: 2px solid var(--primary);
        }
        .detail-table th, .detail-table td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        .detail-table th { background: #f8f9fa; font-weight: 700; color: var(--primary); }
        .detail-table tr { page-break-inside: avoid; }

        /* â˜…â˜…â˜… ëª¨ë°”ì¼ ì „ìš© ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ â˜…â˜…â˜… */
        @media (max-width: 600px) {
            .container { padding: 25px 20px; }
            h1 { font-size: 1.5rem; }
            
            /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ ë° ì‚¬ì´ì¦ˆ ì¡°ì ˆ */
            .btn-text {
                font-size: 0.8rem; /* ê¸€ì í¬ê¸° ì¤„ì„ */
                padding: 0;
                height: 42px;
                letter-spacing: -0.5px; /* ìê°„ ì¢í˜ */
            }
            
            /* ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì¤„ê°„ê²© í™•ë³´ */
            .question-text { line-height: 1.5; }
            
            /* ìˆœìœ„ ë°•ìŠ¤ ì„¸ë¡œ ë°°ì¹˜ */
            .rank-container { flex-direction: column; gap: 15px; }
            
            /* ì°¨íŠ¸ ë†’ì´ ì¡°ì ˆ */
            .chart-container { height: 250px; }
            
            /* AI ê²°ê³¼ ìš”ì•½ í°íŠ¸ ì¡°ì ˆ */
            .one-liner-main { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <h3 style="border:none; margin:0; color:#555;">ì‹¬ì¸µ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤</h3>
    <p style="font-size:0.9rem; color:#888;">ì•½ 10~30ì´ˆ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
</div>

<div class="container">
    <div id="quiz-area">
        <h1 id="main-title" title="3ë²ˆ í´ë¦­ ì‹œ ìë™ ì²´í¬">í•œêµ­í˜• ì‚¬íšŒì„± ê²€ì‚¬(KSIP)</h1>
        
        <div style="background:#fff; border:1px solid #eee; padding:15px; margin-bottom:30px; border-radius:8px; font-size:0.9rem; color:#666; box-shadow:0 2px 5px rgba(0,0,0,0.03);">
            <strong>[ê²€ì‚¬ ì•ˆë‚´]</strong><br>
            ë¬¸í•­ì„ ì½ê³  í‰ì†Œ ìì‹ ì˜ ëª¨ìŠµê³¼ ê°€ì¥ ê°€ê¹Œìš´ ê²ƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”.<br>
            <span style="color:var(--accent); font-size:0.8rem;">(1: ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤ ~ 5: ë§¤ìš° ê·¸ë ‡ë‹¤)</span>
        </div>
        <form id="quiz-form"></form>
        <button id="submit-btn" class="action-btn" onclick="calculateResult()">ê²€ì‚¬ ê²°ê³¼ ë¶„ì„</button>
    </div>

    <div id="result-area">
        <div id="pdf-content" style="padding: 20px; background: white;">
            
            <div style="margin-bottom: 30px;">
                <h1 style="margin-top:0; font-size: 1.8rem; text-align:left; border-bottom:3px solid var(--primary); padding-bottom:15px; color:var(--primary);">KSIP ì‹¬ë¦¬ í‰ê°€ ë³´ê³ ì„œ</h1>
                <p style="font-size:0.9rem; color:#888; margin-bottom:20px;">ë³¸ ë¦¬í¬íŠ¸ëŠ” KSIP ê²€ì‚¬ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ AI ì„ìƒ ë¶„ì„ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                
                <div class="one-liner-box">
                    <div id="result-subtitle" class="one-liner-sub">PRIMARY PROFILE</div>
                    <div id="result-main-title" class="one-liner-main"></div>
                </div>
            </div>

            <div>
                <h3>1. ìœ í˜•ë³„ ì ìˆ˜ ìš”ì•½</h3>
                <div class="rank-container">
                    <div class="rank-box">
                        <span class="rank-title" style="color:#2980b9;">â–² ë†’ì€ ì ìˆ˜ (í•µì‹¬ ê°•ì )</span>
                        <div id="high-rank-list" class="rank-list"></div>
                    </div>
                    <div class="rank-box">
                        <span class="rank-title" style="color:#c0392b;">â–¼ ë‚®ì€ ì ìˆ˜ (ë³´ì™„ì )</span>
                        <div id="low-rank-list" class="rank-list"></div>
                    </div>
                </div>
            </div>

            <div id="ai-trigger-area" class="ai-btn-area">
                <h3 style="margin:0 0 10px 0; border:none; padding:0; color:#333;">AI ì‹¬ì¸µ ë¶„ì„ ìš”ì²­</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">
                    ì „ë¬¸ ìƒë‹´ ìˆ˜ì¤€ì˜ ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.<br>
                    <span style="color:#999; font-size:0.8rem;">(ë¶„ì„ì—ëŠ” ì•½ 10~30ì´ˆê°€ ì†Œìš”ë©ë‹ˆë‹¤)</span>
                </p>
                <button id="ai-btn" class="action-btn" onclick="callAppsScript()">ì‹¬ì¸µ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
            </div>

            <div id="ai-result-container" style="display:none; margin-top: 30px;">
                <h3>2. ì‹¬ì¸µ ì‹¬ë¦¬ ë¶„ì„</h3>
                
                <div class="ai-section-group">
                    <h4 style="margin-bottom:12px; color:var(--primary); font-size:1.1rem;">ğŸš€ í•µì‹¬ ë¬´ê¸°ì™€ ì ì¬ë ¥</h4>
                    <div id="ai-strength" class="ai-box"></div>
                </div>

                <div class="ai-section-group">
                    <h4 style="margin-bottom:12px; color:var(--primary); font-size:1.1rem;">ğŸŒ± ë‚´ë©´ì˜ ê·¸ë¦¼ìì™€ ë³´ì™„ì </h4>
                    <div id="ai-weakness" class="ai-box"></div>
                </div>

                <div class="ai-section-group">
                    <h4 style="margin-bottom:12px; color:var(--primary); font-size:1.1rem;">ğŸ’¡ ì „ë¬¸ ìƒë‹´ ì œì•ˆ</h4>
                    <div id="ai-advice" class="ai-box" style="border-left-color: #27ae60; background-color:#f9fffb;"></div>
                </div>
            </div>

            <div style="page-break-inside: avoid; margin-top: 50px;">
                <h3>3. ìœ í˜•ë³„ ë¶„í¬ë„</h3>
                <div class="chart-container"><canvas id="resultChart"></canvas></div>
                <div style="text-align:right; font-size:0.85rem; color:#999; margin-top:10px;">
                    * SQ ì§€ìˆ˜: <strong id="sq-score-text" style="color:var(--primary);">0</strong>ì 
                </div>
            </div>

            <div style="margin-top:50px;">
                <h3>4. ë¬¸í•­ë³„ ì‘ë‹µ ìƒì„¸</h3>
                <table class="detail-table" id="detail-table">
                    <thead><tr><th width="15%">ìœ í˜•</th><th>ë¬¸í•­ ë‚´ìš©</th><th width="10%">ì ìˆ˜</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

        </div>

        <div style="display:flex; gap:10px; margin-top:30px;">
            <button id="pdf-btn" class="action-btn" onclick="savePDF()">PDF ë³´ê³ ì„œ ì €ì¥</button>
            <button id="retry-btn" class="action-btn" onclick="location.reload()">ìƒˆ ê²€ì‚¬ ì‹œì‘</button>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // â˜…â˜…â˜… [ì¤‘ìš”] ë°°í¬í•œ Apps Script URL ì…ë ¥ â˜…â˜…â˜…
    // ============================================================
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbymXtdueUHPE7bkNOomJh4GGZv2eRaoY41-zn2TsxudQkcMsZOXfCZo7Idt-PokJitEjQ/exec"; 

    // ì¹˜íŠ¸í‚¤
    let titleClickCount = 0;
    document.getElementById('main-title').addEventListener('click', function() {
        titleClickCount++;
        if (titleClickCount === 3) {
            const totalQuestions = document.querySelectorAll('.question-box').length;
            for (let i = 0; i < totalQuestions; i++) {
                const randomVal = Math.floor(Math.random() * 5) + 1; 
                document.getElementsByName(`q${i}`)[randomVal - 1].checked = true;
            }
            alert("í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ìë™ ì…ë ¥ ì™„ë£Œ");
            titleClickCount = 0;
        }
    });

    const typeNamesMap = {
        "1": "1ë²ˆ(ì†Œ)", "2": "2ë²ˆ(ê°•ì•„ì§€)", "3": "3ë²ˆ(ë…ìˆ˜ë¦¬)",
        "4": "4ë²ˆ(ê³ ì–‘ì´)", "5": "5ë²ˆ(ë¶€ì—‰ì´)", "6": "6ë²ˆ(ì‚¬ìŠ´)",
        "7": "7ë²ˆ(ì›ìˆ­ì´)", "8": "8ë²ˆ(í˜¸ë‘ì´)", "9": "9ë²ˆ(ì½”ë¼ë¦¬)"
    };

    const rawQuestions = [
        { q: "ë‚˜ëŠ” ëª¨ë“  ì¼ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ê¹Šì´ ìƒê°í•´ì„œ í–‰ë™í•œë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ë•Œë•Œë¡œ ë¶„ë…¸ë¥¼ ëŠë‚€ë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ë„ë•ì ìœ¼ë¡œ ìì œë ¥ì´ ìˆëŠ” ì‚¬ëŒì´ë‹¤.", type: "1" }, { q: "ë‚˜ì˜ í–‰ë™ì€ ì›ì¹™ì— ê¸°ì´ˆë¥¼ ë‘”ë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ì™„ë²½ì„ ìœ„í•´ ëê¹Œì§€ ë…¸ë ¥í•œë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ë•Œë•Œë¡œ ì—„ê²©í•˜ì—¬ ìœµí†µì„±ì´ ì—†ë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ë¡œë¶€í„° ì‹ ì„ì„ ì–»ê³  ìˆë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ì˜³ê³  ê·¸ë¦„ì´ ë¶„ëª…í•˜ì—¬ ë•Œë¡œ ë¹„íŒì ì´ë‹¤.", type: "1" }, { q: "ë‚˜ëŠ” ì£¼ë¡œ ë‚˜ì˜ ì–‘ì‹¬ê³¼ ì´ì„±ì— ë”°ë¼ í–‰ë™í•œë‹¤.", type: "1" },
        { q: "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ì¼í•˜ê¸°ë¥¼ ë” ì¢‹ì•„í•œë‹¤.", type: "2" }, { q: "ë‚˜ì˜ ê´€ì‹¬ì‚¬ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì„ ë„ì™€ì£¼ëŠ” ê²ƒì´ë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì„ ì§€ë‚˜ì¹˜ê²Œ ì¹­ì°¬í•œë‹¤.", type: "2" }, { q: "ë‚´ ìƒê°ë³´ë‹¤ëŠ” ë‚¨ì˜ ìƒê°ì— ê³µê°í•  ë•Œê°€ ë§ë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” ì¹œêµ¬ë“¤ì„ ë„ì™€ì¤„ ë•Œ ê¸°ë¶„ì´ ì¢‹ë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì„ ê´€ì‹¬ ìˆê²Œ ëŒ€í•˜ê³  ë³´ì‚´í”¼ë ¤ í•œë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ê³¼ ì¹œí•´ì§€ë ¤ê³  ë§ì´ ë…¸ë ¥í•˜ê³  ìˆë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” íƒ€ì¸ì˜ ê°ì •ì„ ìœ„í•´ ìì‹ ì„ í¬ìƒí•˜ê¸°ë„ í•œë‹¤.", type: "2" }, { q: "ë‚˜ëŠ” íƒ€ì¸ì˜ í˜¸ê°ì„ ì–»ê¸° ìœ„í•´ ì•„ì²¨í•˜ê¸°ë„ í•œë‹¤.", type: "2" },
        { q: "ë‚˜ëŠ” ëŠ¥ë ¥ì„ ë°œíœ˜í•˜ëŠ” ë° ë§ì€ ì‹œê°„ì„ íˆ¬ìí•œë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ê³¼ì •ë³´ë‹¤ëŠ” ê²°ê³¼ê°€ ì¤‘ìš”í•˜ë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ì¸ê°„ ì¤‘ì‹¬ì ì´ê¸° ë³´ë‹¤ëŠ” ì˜¤íˆë ¤ ëª©í‘œ ì¤‘ì‹¬ì ì´ë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ ìƒí™©ì— ì ì ˆíˆ ëŒ€ì‘í•œë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ì§€ë‚˜ì¹˜ê²Œ ê²½ìŸí•œë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì— ëŒ€í•œ ë°°ë ¤ë³´ë‹¤ëŠ” ì¼ì˜ ì„±ì·¨ë¥¼ ë” ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ì„±ê³µì´ ì• ì •ì„ íšë“í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ëŠ”ë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ë§¡ì€ ì¼ì„ íš¨ìœ¨ì ìœ¼ë¡œ í•œë‹¤.", type: "3" }, { q: "ë‚˜ëŠ” ë’¤ë–¨ì–´ì§€ì§€ ì•Šê¸° ìœ„í•´ ë¬´ì—‡ì¸ê°€ë¥¼ ëŠì„ì—†ì´ í–‰í•œë‹¤.", type: "3" },
        { q: "ë‚˜ëŠ” ê°ì„±ì ì´ì–´ì„œ í˜¼ì ìˆì„ ë•Œê°€ ë§ë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” í˜¼ìì„œ ìì‹ ë§Œì˜ ê³ ìƒí•œ ì·¨ë¯¸ë¥¼ ì¦ê¸´ë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ë‚­ë§Œì ì´ê³  ì˜ˆìˆ ê°€ì  ê¸°ì§ˆì´ ìˆë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ì´ë°©ì¸ì²˜ëŸ¼ ëŠë‚„ ë•Œê°€ ìˆë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë³´ë‹¤ ë…íŠ¹í•œ ê°ì •ì„ ê°€ì§€ê³  ìˆë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ë•Œë¡œ ë¶„ìœ„ê¸°ì— ë”°ë¼ ë‚˜ì˜ ê°ì •ì´ ë³€í•œë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ë§ˆìŒì´ ë”°ëœ»í•˜ì§€ë§Œ ë•Œë¡œ ì§ˆíˆ¬ì‹¬ì´ ë‚œë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” ê°ë™ì ì¸ ê²ƒì„ ì¶”êµ¬í•˜ë‹¤ê°€ í˜¼ì ìš°ìš¸í•´ì§€ê¸°ë„ í•œë‹¤.", type: "4" }, { q: "ë‚˜ëŠ” í‰ë²”í•œ ì‚¶ì˜ ë°©ì‹ì„ ì‹«ì–´í•œë‹¤.", type: "4" },
        { q: "ë‚˜ëŠ” ë¬´ì—‡ì¸ê°€ì— ì§‘ì¤‘í•˜ì—¬ í†µì°°í•œë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ë¬¸ì œê°€ ìˆìœ¼ë©´ í’€ë¦´ ë•Œê¹Œì§€ ê·¸ê²ƒë§Œ ê³¨ë˜˜íˆ ìƒê°í•œë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ê³µì ì¸ ê²ƒë³´ë‹¤ëŠ” ê°œì¸ìƒí™œì— ëŒ€í•œ ê´€ì‹¬ì´ ë§ë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ë¶„ì„ì ì¸ ì‚¬ê³ ë¥¼ ê°€ì§€ê³  ìˆë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ì‹œê°„ì´ë‚˜ ëˆì„ ì•„ë¼ëŠ” ê²½í–¥ì´ ìˆë‹¤.", type: "5" }, { q: "ë‚˜ì˜ ê´€ì‹¬ì‚¬ëŠ” ë‚˜ë¥¼ ë‘˜ëŸ¬ì‹¼ ì„¸ê³„ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ìŠ¤ìŠ¤ë¡œ ê³ ë¦½í•˜ì—¬ ê³ ë¯¼í•˜ê¸°ë„ í•œë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ì§€ì ìœ¼ë¡œ ëƒ‰ì² í•˜ê²Œ ê´€ì°°í•˜ëŠ” í¸ì´ë‹¤.", type: "5" }, { q: "ë‚˜ëŠ” ë¨¸ë¦¬ë¡œ ëª¨ë“  ê²ƒì„ ì´í•´í•˜ê³  íŒë‹¨í•œë‹¤.", type: "5" },
        { q: "ë‚˜ëŠ” ëª…í™•í•œ ì§€ì¹¨ì´ ìˆì„ ë•Œ ì¼ì˜ ëŠ¥ë¥ ì´ ì˜¤ë¥¸ë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒì„ ê°€ë” ì˜ì‹¬í•˜ëŠ” ê²½í–¥ì´ ìˆë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ê°€ë” ìì‹ ì„ ë¶€ì •í•˜ê±°ë‚˜ ì˜ì‹¬í•œë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ì†Œì† ì§‘ë‹¨ì— í˜‘ë ¥í•˜ì—¬ ì±…ì„ê°ì„ ë°œíœ˜í•œë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ëª¨ë“  ì¼ì—ì„œ ì•ˆì „ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.", type: "6" }, { q: "ì‚¬ëŒë“¤ì€ ë‚˜ì—ê²Œ ìš©ê¸°ê°€ í•„ìš”í•˜ë‹¤ê³  ë§í•œë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ê²°ê³¼ì— ëŒ€í•œ ë‘ë ¤ì›€ ë•Œë¬¸ì— ì¼ì„ ì§ˆì§ˆ ë„ëŠ” ê²½ìš°ê°€ ìˆë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ì¶©ì„±í•  ë§Œí•œ ì‚¬ëŒì—ê²ŒëŠ” í—Œì‹ í•  ìˆ˜ ìˆë‹¤.", type: "6" }, { q: "ë‚˜ëŠ” ì¹œí•˜ê²Œ ì§€ë‚´ëŠ” ì‚¬ëŒê³¼ ì˜ì›í•œ ìš°ì •ì„ ìœ ì§€í•˜ë„ë¡ ë…¸ë ¥í•œë‹¤.", type: "6" },
        { q: "ë‚˜ëŠ” ìë°œì ìœ¼ë¡œ ì¬ë¯¸ìˆëŠ” ì¼ì„ ì¦ê¸´ë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ëª¨í—˜ì ì´ë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ëŠì„ì—†ì´ ë³€í™”í•˜ëŠ” ìƒí™œì„ ì¢‹ì•„í•œë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ìê·¹ê³¼ í¥ë¶„ì„ ìœ ë°œí•˜ëŠ” í™œë™ì„ ì¢‹ì•„í•œë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ë•Œë•Œë¡œ ì–´ë¦°ì•„ì´ì²˜ëŸ¼ ìœ ì¾Œí•˜ë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ë‚™ì²œì ìœ¼ë¡œ ì„¸ìƒì„ ì‚´ì•„ê°„ë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ì—¬ëŸ¬ê°€ì§€ ìƒˆë¡œìš´ ê²½í—˜ì„ ì¶”êµ¬í•œë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” í•œ ê°€ì§€ ì¼ì— ì •ì°©í•˜ê¸°ê°€ ì–´ë µë‹¤.", type: "7" }, { q: "ë‚˜ëŠ” ì°¸ì„ì„±ì´ ì—†ëŠ” í¸ì´ë‹¤.", type: "7" },
        { q: "ë‚˜ì—ê²ŒëŠ” ì§€ë„ìë¡œì„œì˜ ê¸°ì§ˆì´ ìˆë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ë‚˜ì˜ ëœ»ëŒ€ë¡œ ê²°ì •í•˜ë ¤ê³  í•œë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ëŠ˜ ê°•í•´ì•¼ ëœë‹¤ê³  ìƒê°í•œë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì„ ì§€ë°°í•˜ë ¤ëŠ” ê²½í–¥ì´ ìˆë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ì¼ì„ ê³¼ê°í•˜ê²Œ ì¶”ì§„í•œë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ê³µê²©ì ìœ¼ë¡œ ìê¸°ì£¼ì¥ì„ ë§í•œë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì„ í†µì œí•˜ë ¤ í•œë‹¤.", type: "8" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ì„ ì§€ì‹œí•˜ì—¬ ë™ê¸°ë¥¼ ë¶€ì—¬í•œë‹¤. ", type: "8" }, { q: "ë‚˜ëŠ” ê°•í•œ ìì‹ ê°ìœ¼ë¡œ ì‚¬ëŒë“¤ì„ ì„¤ë“ì‹œí‚¨ë‹¤.", type: "8" },
        { q: "ë‚˜ëŠ” ìê¸°ë§Œì¡±ì ì´ë©° íƒœí‰í•œ í¸ì´ë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ê²Œìœ¼ë¥¸ í¸ì´ë‹¤", type: "9" }, { q: "ë‚˜ëŠ” ëª¨ë“  ì¼ë“¤ì´ ìˆœì¡°ë¡­ê²Œ ë˜ê¸¸ ì›í•œë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ì†ìƒí•œ ì¼ë“¤ì„ ì¶•ì†Œí•˜ë ¤ê³  í•œë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ì‚¬ëŒë“¤ê³¼ ì¢‹ì€ ê´€ê³„ë¥¼ ìœ ì§€í•˜ë ¤ í•œë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ì¹œêµ¬ë“¤ì˜ ì˜ê²¬ì— ë™ì¡°í•˜ëŠ” í¸ì´ë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ì„¸ìƒì˜ ì¼ë“¤ê³¼ ì¡°í™”ë¡­ê²Œ í˜ëŸ¬ê°€ê³  ì‹¶ë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ í•˜ëŠ” ì¼ì— ìƒê´€í•˜ì§€ ì•ŠëŠ” í¸ì´ë‹¤.", type: "9" }, { q: "ë‚˜ëŠ” ì¡°í™”ë¡œì›€ì„ ì¶”êµ¬í•˜ëŠ” í‰í™”ì£¼ì˜ìë‹¤.", type: "9" },
        { q: "ë‚˜ëŠ” ë•Œë¡œëŠ” ìš´ëª…ì´ë‚˜ ì¸ì—°ì„ ë¯¿ëŠ”ë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ì„¸ìƒì˜ ì§„ë¦¬ì— ëŒ€í•´ ê¶ê¸ˆí•´ í•œ ì ì´ ìˆë‹¤.", type: "SQ" }, { q: "í˜ë“¤ë•Œ ë‚˜ë„ ëª¨ë¥´ê²Œ ë³´ì´ì§€ ì•ŠëŠ” ê²ƒë“¤(ì¢…êµ, ë¯¸ì‹ )ì— ì˜ì§€í•œë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ì†Œìˆ˜ë¼ í•˜ì—¬ë„ ì•„ë‹Œê±¸ ì•„ë‹ˆë¼ê³  í•  ìˆ˜ ìˆë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ë¬¼ì§ˆì ì¸ ê²ƒ ë³´ë‹¤ ë‚´ë©´ì´ ë”ìš± ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•œë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ì‹ ì˜ ì¡´ì¬ë¥¼ ë¯¿ëŠ”ë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ì–¸ë¡ ì´ë‚˜ ì¸í„°ë„·ë³´ë‹¤ ì‹¤ì œë¡œ ë³´ê³  ë“¤ì€ ê²ƒì„ ë¯¿ëŠ” í¸ì´ë‹¤.", type: "SQ" }, { q: "ë‚˜ëŠ” ì•½ì†ì„ ì˜ ì§€í‚¨ë‹¤.", type: "SQ" }
    ];

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    const shuffledQuestions = shuffleArray([...rawQuestions]);
    const formContainer = document.getElementById('quiz-form');
    let finalScores = {};

    shuffledQuestions.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'question-box';
        div.setAttribute('data-type', item.type);
        div.setAttribute('data-qtext', item.q);
        div.setAttribute('data-index', index);
        div.innerHTML = `
            <span class="question-text">Q${index + 1}. ${item.q}</span>
            <div class="options">
                <label class="option-label"><input type="radio" name="q${index}" value="1"><div class="btn-text">ì „í˜€ ì•„ë‹˜</div></label>
                <label class="option-label"><input type="radio" name="q${index}" value="2"><div class="btn-text">ì•„ë‹˜</div></label>
                <label class="option-label"><input type="radio" name="q${index}" value="3"><div class="btn-text">ë³´í†µ</div></label>
                <label class="option-label"><input type="radio" name="q${index}" value="4"><div class="btn-text">ê·¸ë ‡ë‹¤</div></label>
                <label class="option-label"><input type="radio" name="q${index}" value="5"><div class="btn-text">ë§¤ìš° ê·¸ë ‡ë‹¤</div></label>
            </div>
        `;
        formContainer.appendChild(div);
    });

    function calculateResult() {
        let scores = { "1":0, "2":0, "3":0, "4":0, "5":0, "6":0, "7":0, "8":0, "9":0, "SQ":0 };
        let answeredCount = 0;
        let userResponses = [];

        const questionBoxes = document.querySelectorAll('.question-box');
        for (let box of questionBoxes) {
            const index = box.getAttribute('data-index');
            const type = box.getAttribute('data-type');
            const qText = box.getAttribute('data-qtext');
            const inputs = document.getElementsByName(`q${index}`);
            let value = 0;
            for (let input of inputs) {
                if (input.checked) { value = parseInt(input.value); break; }
            }
            if (value > 0) {
                answeredCount++;
                scores[type] += value;
                userResponses.push({ type: type, text: qText, score: value });
            }
        }

        if (answeredCount < shuffledQuestions.length) {
            alert(`ë‹µë³€í•˜ì§€ ì•Šì€ ë¬¸í•­ì´ ìˆìŠµë‹ˆë‹¤. (${answeredCount}/${shuffledQuestions.length})`);
            return;
        }

        finalScores = scores;
        showResult(scores, userResponses);
    }

    function showResult(scores, userResponses) {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);

        document.getElementById('sq-score-text').innerText = scores['SQ'];

        let typeScores = [];
        for(let i=1; i<=9; i++) typeScores.push({ id: i.toString(), score: scores[i] });
        typeScores.sort((a, b) => b.score - a.score);

        const topType = typeScores[0];
        const topTypeId = parseInt(topType.id);
        const top3 = typeScores.slice(0, 3);
        const bottom3 = [...typeScores].reverse().slice(0, 3);

        let centerName = "";
        if ([8, 9, 1].includes(topTypeId)) centerName = "ì¥í˜• (ë³¸ëŠ¥ ì¤‘ì‹¬)";
        else if ([2, 3, 4].includes(topTypeId)) centerName = "ê°€ìŠ´í˜• (ê°ì • ì¤‘ì‹¬)";
        else centerName = "ë¨¸ë¦¬í˜• (ì‚¬ê³  ì¤‘ì‹¬)";

        const topTypeName = typeNamesMap[topTypeId];

        document.getElementById('result-main-title').innerHTML = 
            `<span style="color:#a8b2c1; font-size:1rem; font-weight:normal; letter-spacing:1px; text-transform:uppercase;">${centerName}</span><br>
             <span style="font-size:1.8rem; color:#fff;">${topTypeName}</span> <span style="font-size:1.2rem; font-weight:300;">ì„±í–¥</span>`;

        let highHtml = "";
        top3.forEach((item, idx) => { highHtml += `<span>${idx+1}ìœ„: <b>${item.id}ë²ˆ</b> (${item.score}ì )</span>`; });
        document.getElementById('high-rank-list').innerHTML = highHtml;

        let lowHtml = "";
        bottom3.forEach((item, idx) => { lowHtml += `<span>${idx+1}ìœ„: <b>${item.id}ë²ˆ</b> (${item.score}ì )</span>`; });
        document.getElementById('low-rank-list').innerHTML = lowHtml;

        const ctx = document.getElementById('resultChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['1ë²ˆ', '2ë²ˆ', '3ë²ˆ', '4ë²ˆ', '5ë²ˆ', '6ë²ˆ', '7ë²ˆ', '8ë²ˆ', '9ë²ˆ'],
                datasets: [{
                    label: 'ì ìˆ˜', data: [scores['1'], scores['2'], scores['3'], scores['4'], scores['5'], scores['6'], scores['7'], scores['8'], scores['9']],
                    backgroundColor: 'rgba(26, 37, 47, 0.8)', 
                    borderColor: 'rgba(26, 37, 47, 1)', 
                    borderWidth: 1
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                animation: {duration: 0}, 
                scales: {
                    y: {beginAtZero: true, max: 50, grid: {color:'#f0f0f0'}},
                    x: {grid: {display:false}}
                } 
            }
        });

        const tableBody = document.querySelector('#detail-table tbody');
        userResponses.sort((a, b) => {
            if (a.type === 'SQ') return 1; if (b.type === 'SQ') return -1;
            return parseInt(a.type) - parseInt(b.type);
        });
        userResponses.forEach(res => {
            const tr = document.createElement('tr');
            let typeColor = res.type === 'SQ' ? '#95a5a6' : '#2c3e50';
            let typeName = res.type === 'SQ' ? 'SQ' : res.type + 'ë²ˆ';
            let scoreWeight = res.score >= 4 ? 'bold' : 'normal';
            tr.innerHTML = `<td style="text-align:center;"><span style="background:${typeColor}; color:white; padding:4px 8px; border-radius:4px; font-size:0.75rem;">${typeName}</span></td><td>${res.text}</td><td style="text-align:center; font-weight:${scoreWeight};">${res.score}</td>`;
            tableBody.appendChild(tr);
        });
    }

    function callAppsScript() {
        if (!GAS_WEB_APP_URL || GAS_WEB_APP_URL.includes("ì—¬ê¸°ì—_URL")) {
            alert("HTML ì½”ë“œ ìƒë‹¨ì— Google Apps Script URLì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        document.getElementById('loading-overlay').style.display = 'flex';

        fetch(GAS_WEB_APP_URL, {
            method: 'POST',
            mode: 'cors',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify({ scores: finalScores })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('loading-overlay').style.display = 'none';

            if(data.error) {
                alert("ë¶„ì„ ì‹œìŠ¤í…œ ì˜¤ë¥˜: " + data.error);
                return;
            }

            document.getElementById('ai-trigger-area').style.display = 'none';
            document.getElementById('ai-result-container').style.display = 'block';
            
            document.getElementById('ai-strength').innerHTML = marked.parse(data.strength || "ë¶„ì„ ë‚´ìš© ì—†ìŒ");
            document.getElementById('ai-weakness').innerHTML = marked.parse(data.weakness || "ë¶„ì„ ë‚´ìš© ì—†ìŒ");
            document.getElementById('ai-advice').innerHTML = marked.parse(data.advice || "ë¶„ì„ ë‚´ìš© ì—†ìŒ");
            
            document.querySelectorAll('.ai-box').forEach(el => el.style.display = 'block');
            document.getElementById('ai-result-container').scrollIntoView({behavior: "smooth"});
        })
        .catch(error => {
            document.getElementById('loading-overlay').style.display = 'none';
            alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }

    function savePDF() {
        window.scrollTo(0, 0);
        const element = document.getElementById('pdf-content');
        const btn = document.getElementById('pdf-btn');
        btn.innerText = "ì €ì¥ ì¤‘...";
        
        const opt = {
            margin: [10, 10, 10, 10], 
            filename: 'KSIP_Psychological_Report.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, scrollY: 0, useCORS: true }, 
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] } 
        };
        
        html2pdf().set(opt).from(element).save().then(() => { btn.innerText = "PDF ë³´ê³ ì„œ ì €ì¥"; });
    }
</script>

</body>
</html>
